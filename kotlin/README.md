# <img src="../doc/images/logo_kotlin.png" width="40px"> jOOQ hands-on

[![Tests](https://github.com/sylvaindecout/jooq-handson/actions/workflows/gradle.yml/badge.svg?branch=main)](https://github.com/sylvaindecout/jooq-handson/actions/workflows/gradle.yml) [![Gitmoji](https://img.shields.io/badge/gitmoji-%20%F0%9F%98%9C%20%F0%9F%98%8D-FFDD67.svg)](https://gitmoji.dev)

## Usage

* Run tests: `./gradlew test`
* Start test DB: `cd .. && docker compose up -d`
* Start server: `./gradlew bootRun`
* Populate test DB: `docker exec -i jooq-handson-database psql postgresql://user:user123@localhost:5432/handson < ../database/init_data.sql`
* Use REST API: [OpenAPI specification](../openapi.yml)

## Steps

[Introduction](../doc/intro.md)

1. [Basic commands](src/main/kotlin/fr/sdecout/handson/persistence/library/DbLibraryAdapter.kt)
2. [Queries from single tables](src/main/kotlin/fr/sdecout/handson/persistence/library/DbLibraryAdapter.kt)
3. [Queries from several tables](src/main/kotlin/fr/sdecout/handson/persistence/library/DbLibraryAdapter.kt)
4. [Nested queries](src/main/kotlin/fr/sdecout/handson/persistence/book/DbBookAdapter.kt)
5. [Batch operations](src/main/kotlin/fr/sdecout/handson/persistence/book/DbBookAdapter.kt)
6. [Code generation](src/main/kotlin/fr/sdecout/handson/rest/shared/BookField.kt)
7. [Type converters](src/main/kotlin/fr/sdecout/handson/persistence/converters/IsbnConverter.kt)
8. [Supporting specifics with Testcontainers](src/main/kotlin/fr/sdecout/handson/rest/shared/AddressField.kt)

[Conclusion](../doc/conclusion.md)

> ðŸ’¡ Feeling stuck?
> * Do you have a clear idea of the [DB schema](../README.md#db-schema)?
> * Did you start the test DB so that you can experiment with SQL queries? (cf. [Usage](#usage))
> * Have you checked out the link to jOOQ documentation provided in the step instructions?

## Troubleshooting

* You use IntelliJ as your IDE, and it does not recognize the project:
  * Right-click `build.gradle.kts` file and select "Link Gradle Project".

* You use IntelliJ as your IDE, and it does find source code generated by jOOQ:
  * Right-click `src/generated` directory and select "Mark directory as Generated Sources Root".

* Tests fail with the following error:
  ```
  Failed to load ApplicationContext for [WebMergedContextConfiguration@...]
  java.lang.IllegalStateException: Failed to load ApplicationContext for [WebMergedContextConfiguration@...]
    [...]
  Caused by: java.lang.IllegalStateException: Could not find a valid Docker environment. Please see logs and check configuration
    [...]
  ```
  * Check that Docker is up and running

* When you start test DB, it fails with the following error:
  ```
  unable to get image 'jooq-handson-database': Cannot connect to the Docker daemon at unix:///Users/sylvaindecout/.docker/run/docker.sock. Is the docker daemon running?
  ```
  * Check that Docker is up and running

## Context

More info in [parent directory](../README.md).
